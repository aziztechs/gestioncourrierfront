<div class="courrier-list-container">
  <!-- Header -->
  <div class="header-section">
    <h1>Gestion des Courriers</h1>
    <button mat-raised-button color="primary" (click)="addNewCourrier()">
      <mat-icon>add</mat-icon>
      Nouveau Courrier
    </button>
  </div>

  <!-- Filters Section -->
  <mat-card class="filters-card">
    <mat-card-header>
      <mat-card-title>Filtres de recherche</mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <div class="filters-row">
        <!-- Search Text -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Recherche</mat-label>
          <input matInput [(ngModel)]="searchText" placeholder="Numéro, objet, expéditeur..." (keyup.enter)="applyFilter()">
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>

        <!-- Type Filter -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Type</mat-label>
          <mat-select [(value)]="filterType">
            <mat-option value="">Tous</mat-option>
            <mat-option [value]="TypeCourrier.INTERNE">Interne</mat-option>
            <mat-option [value]="TypeCourrier.EXTERNE">Externe</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Nature Filter -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Nature</mat-label>
          <mat-select [(value)]="filterNature">
            <mat-option value="">Toutes</mat-option>
            <mat-option [value]="NatureCourrier.ARRIVE">Arrivé</mat-option>
            <mat-option [value]="NatureCourrier.DEPART">Départ</mat-option>
          </mat-select>
        </mat-form-field>

        <!-- Date Start -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Date début</mat-label>
          <input matInput [matDatepicker]="startPicker" [(ngModel)]="filterDateStart">
          <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
          <mat-datepicker #startPicker></mat-datepicker>
        </mat-form-field>

        <!-- Date End -->
        <mat-form-field appearance="outline" class="filter-field">
          <mat-label>Date fin</mat-label>
          <input matInput [matDatepicker]="endPicker" [(ngModel)]="filterDateEnd">
          <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
          <mat-datepicker #endPicker></mat-datepicker>
        </mat-form-field>
      </div>

      <div class="filter-actions">
        <button mat-raised-button color="primary" (click)="applyAdvancedFilters()">
          <mat-icon>filter_list</mat-icon>
          Filtrer
        </button>
        <button mat-button (click)="clearFilters()">
          <mat-icon>clear</mat-icon>
          Effacer
        </button>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Loading Spinner -->
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Chargement des courriers...</p>
  </div>

  <!-- Data Table -->
  <mat-card *ngIf="!loading" class="table-card">
    <mat-table [dataSource]="dataSource" matSort class="courrier-table">
      
      <!-- Numéro Courrier Column -->
      <ng-container matColumnDef="numCourrier">
        <mat-header-cell *matHeaderCellDef mat-sort-header>N° Courrier</mat-header-cell>
        <mat-cell *matCellDef="let courrier">
          <strong>{{ courrier.numCourrier }}</strong>
        </mat-cell>
      </ng-container>

      <!-- Objet Column -->
      <ng-container matColumnDef="objet">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Objet</mat-header-cell>
        <mat-cell *matCellDef="let courrier" class="objet-cell">
          {{ courrier.objet }}
        </mat-cell>
      </ng-container>

      <!-- Type Column -->
      <ng-container matColumnDef="type">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Type</mat-header-cell>
        <mat-cell *matCellDef="let courrier">
          <mat-chip [color]="courrier.type === TypeCourrier.INTERNE ? 'primary' : 'accent'" selected>
            {{ getTypeLabel(courrier.type) }}
          </mat-chip>
        </mat-cell>
      </ng-container>

      <!-- Nature Column -->
      <ng-container matColumnDef="nature">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Nature</mat-header-cell>
        <mat-cell *matCellDef="let courrier">
          <mat-chip [color]="courrier.nature === NatureCourrier.ARRIVE ? 'primary' : 'warn'" selected>
            <mat-icon>{{ courrier.nature === NatureCourrier.ARRIVE ? 'arrow_downward' : 'arrow_upward' }}</mat-icon>
            {{ getNatureLabel(courrier.nature) }}
          </mat-chip>
        </mat-cell>
      </ng-container>

      <!-- Expéditeur Column -->
      <ng-container matColumnDef="expediteur">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Expéditeur</mat-header-cell>
        <mat-cell *matCellDef="let courrier">{{ courrier.expediteur }}</mat-cell>
      </ng-container>

      <!-- Destinataire Column -->
      <ng-container matColumnDef="destinataire">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Destinataire</mat-header-cell>
        <mat-cell *matCellDef="let courrier">{{ courrier.destinataire }}</mat-cell>
      </ng-container>

      <!-- Date Column -->
      <ng-container matColumnDef="date">
        <mat-header-cell *matHeaderCellDef mat-sort-header>Date</mat-header-cell>
        <mat-cell *matCellDef="let courrier">{{ formatDate(courrier.date) }}</mat-cell>
      </ng-container>

      <!-- Actions Column -->
      <ng-container matColumnDef="actions">
        <mat-header-cell *matHeaderCellDef>Actions</mat-header-cell>
        <mat-cell *matCellDef="let courrier">
          <button mat-icon-button color="primary" (click)="viewCourrier(courrier)" matTooltip="Voir les détails">
            <mat-icon>visibility</mat-icon>
          </button>
          <button mat-icon-button color="accent" (click)="editCourrier(courrier)" matTooltip="Modifier">
            <mat-icon>edit</mat-icon>
          </button>
          <button mat-icon-button color="warn" (click)="deleteCourrier(courrier)" matTooltip="Supprimer">
            <mat-icon>delete</mat-icon>
          </button>
        </mat-cell>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>

    <!-- Paginator -->
    <mat-paginator 
      [pageSizeOptions]="[5, 10, 20, 50]" 
      showFirstLastButtons
      [pageSize]="10">
    </mat-paginator>
  </mat-card>

  <!-- No Data Message -->
  <mat-card *ngIf="!loading && dataSource.data.length === 0" class="no-data-card">
    <mat-card-content>
      <div class="no-data-content">
        <mat-icon class="no-data-icon">inbox</mat-icon>
        <h3>Aucun courrier trouvé</h3>
        <p>Il n'y a aucun courrier correspondant à vos critères de recherche.</p>
        <button mat-raised-button color="primary" (click)="addNewCourrier()">
          Créer le premier courrier
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
